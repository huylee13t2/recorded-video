/*!
ziggeo-js-sdk - v2.32.7 - 2018-08-11
Copyright (c) Ziggeo
Closed Source Software License.
*/
(function(){var Scoped=this.subScope();Scoped.define("module:",function(){return{guid:"6c65838a-53fd-4fd1-8d48-e571a0500135"}}),Scoped.define("private:Core",function(){return{servers:{local:{whitedomains:["*"],"server.api.server.public.domain":"localhost:91","server.api.server.public.protocol":"http","assets.api.server.public.domain":"localhost:92","assets.api.server.public.protocol":"http","assets-cdn.api.server.public.domain":"localhost:92","assets-cdn.api.server.public.protocol":"http","embed.api.server.public.domain":"localhost:93","embed.api.server.public.protocol":"http","analytics.api.server.public.domain":"localhost:1197","analytics.api.server.public.protocol":"http","embed-cdn.api.server.public.domain":"localhost:93","embed-cdn.api.server.public.protocol":"http","webserver.public.domain":"localhost:98","webserver.public.protocol":"http","hosted.pages.server.public.domain":"localhost:99","hosted.pages.server.public.protocol":"http","wowza.api.record.rtmp.protocol":"rtmp","wowza.api.record.rtmp.domain":"localhost","wowza.api.record.rtmp.path":"record/_definst_","wowza.api.record.webrtc.wssurl":"wss://localhost:4444/webrtc-session.json","wowza.api.record.webrtc.app":"webrtcziggeo",prefix:"",location:"Home",regions:{other:{prefix:"r1",location:"Somewhere","server.api.server.public.domain":"localhost:191","embed.api.server.public.domain":"localhost:193","analytics.api.server.public.domain":"localhost:2197","embed-cdn.api.server.public.domain":"localhost:193","webserver.public.domain":"localhost:198","hosted.pages.server.public.domain":"localhost:199"}},tags:{local:!0,development:!0}},production:{whitedomains:["*.ziggeo.com","ziggeo.com","localhost"],"server.api.server.public.domain":"srvapi.ziggeo.com","server.api.server.public.protocol":"https","assets.api.server.public.domain":"assets.ziggeo.com","assets.api.server.public.protocol":"https","assets-cdn.api.server.public.domain":"assets-cdn.ziggeo.com","assets-cdn.api.server.public.protocol":"https","embed.api.server.public.domain":"embed.ziggeo.com","embed.api.server.public.protocol":"https","analytics.api.server.public.domain":"api-us-east-1.ziggeo.com","analytics.api.server.public.protocol":"https","embed-cdn.api.server.public.domain":"embed-cdn.ziggeo.com","embed-cdn.api.server.public.protocol":"https","webserver.public.domain":"ziggeo.com","webserver.public.protocol":"https","hosted.pages.server.public.domain":"ziggeo.io","hosted.pages.server.public.protocol":"https","wowza.api.record.rtmp.protocol":"rtmps","wowza.api.record.rtmp.domain":"wowza.ziggeo.com","wowza.api.record.rtmp.path":"record/_definst_","wowza.api.record.webrtc.wssurl":"wss://wowza.ziggeo.com:443/webrtc-session.json","wowza.api.record.webrtc.app":"webrtcziggeo",prefix:"",location:"U.S. (US Law)",regions:{"eu-west-1":{prefix:"r1",location:"Ireland (European Law)","server.api.server.public.domain":"srvapi-eu-west-1.ziggeo.com","embed.api.server.public.domain":"embed-eu-west-1.ziggeo.com","analytics.api.server.public.domain":"api-eu-west-1.ziggeo.com","embed-cdn.api.server.public.domain":"embed-cdn-eu-west-1.ziggeo.com","webserver.public.domain":"eu-west-1.ziggeo.com","hosted.pages.server.public.domain":"eu-west-1.ziggeo.io","wowza.api.record.rtmp.domain":"wowza-eu-west-1.ziggeo.com","wowza.api.record.webrtc.wssurl":"wss://wowza-eu-west-1.ziggeo.com:443/webrtc-session.json"}},tags:{production:!0}},development:{whitedomains:["*.ziggeo.com","ziggeo.com","localhost"],"server.api.server.public.domain":"srvapi-dev.ziggeo.com","server.api.server.public.protocol":"https","assets.api.server.public.domain":"assets-dev.ziggeo.com","assets.api.server.public.protocol":"https","assets-cdn.api.server.public.domain":"assets-dev.ziggeo.com","assets-cdn.api.server.public.protocol":"https","embed.api.server.public.domain":"embed-dev.ziggeo.com","embed.api.server.public.protocol":"https","analytics.api.server.public.domain":"api-us-east-1-dev.ziggeo.com","analytics.api.server.public.protocol":"https","embed-cdn.api.server.public.domain":"embed-cdn.ziggeo.com","embed-cdn.api.server.public.protocol":"https","webserver.public.domain":"www-dev.ziggeo.com","webserver.public.protocol":"https","hosted.pages.server.public.domain":"dev.ziggeo.io","hosted.pages.server.public.protocol":"https","wowza.api.record.rtmp.protocol":"rtmps","wowza.api.record.rtmp.domain":"wowza-dev.ziggeo.com","wowza.api.record.rtmp.path":"record/_definst_","wowza.api.record.webrtc.wssurl":"wss://wowza-dev.ziggeo.com:443/webrtc-session.json","wowza.api.record.webrtc.app":"webrtcziggeo",prefix:"",location:"U.S. (US Law)",regions:{"eu-west-1":{prefix:"r1",location:"Ireland (European Law)","server.api.server.public.domain":"srvapi-dev-eu-west-1.ziggeo.com","embed.api.server.public.domain":"embed-dev-eu-west-1.ziggeo.com","analytics.api.server.public.domain":"api-eu-west-1.ziggeo.com","embed-cdn.api.server.public.domain":"embed-cdn-eu-west-1.ziggeo.com","webserver.public.domain":"dev-eu-west-1.ziggeo.com","hosted.pages.server.public.domain":"dev-eu-west-1.ziggeo.io","wowza.api.record.rtmp.domain":"wowza-dev-eu-west-1.ziggeo.com","wowza.api.record.webrtc.wssurl":"wss://wowza-dev-eu-west-1.ziggeo.com:443/webrtc-session.json"}},tags:{development:!0}}},models:{session_cookie_prefix:"i07af2jp98rvoctt26y5egy3"},revision:{version:1,revision:32,latest:!0,prerelease:!1}}}),Scoped.define("private:Application.Analytics",["base:Class","base:Events.EventsMixin","base:Objs","base:Time","base:Timers.Timer","browser:Info","private:Core","private:Environment","private:Logger"],function(a,b,c,d,e,f,g,h,i,j){var k=d.now();return a.extend({scoped:j},[b,function(a){return{constructor:function(b){a.constructor.call(this),this.application=b,this.__google_analytics_events={},b.data.get("google_analytics")&&(this.__google_analytics_events=c.objectify(b.data.get("google_analytics_track"))),this.__queue=[],this.__trackFailed=0,this.__trackSuccess=0,this.application.data.get("analytics")&&(this.__timer=this.auto_destroy(new e({context:this,fire:this.__pushEvents,delay:5e3})))},_generateEvent:function(a,b,c,e,h,i){return i=i||d.now(),c=c||{},e=e||{},h=h||{},{tokens:{application_token:this.application.data.get("token"),video_token:c.video_token,stream_token:c.stream_token},client:{type:"web",version:"v"+g.revision.version+"-"+g.revision.revision,revision:g.revision.revision,sdk_version:a},environment:{location:document.location.href,time:i-k},device:{navigator_appname:navigator.appName,navigator_appcodename:navigator.appCodeName,navigator_appversion:navigator.appVersion,navigator_cookieenabled:navigator.cookieEnabled,navigator_language:navigator.language||navigator.userLanguage||"",navigator_platform:navigator.platform,navigator_useragent:navigator.userAgent,navigator_window_chrome:"chrome"in window,navigator_window_opera:"opera"in window,flash_installed:f.flash().installed(),flash_version_major:f.flash().installed()?f.flash().version().major:0,flash_version_minor:f.flash().installed()?f.flash().version().minor:0},event:{time:i,type:b,media_time:e.media_time||null,embed_type:e.embed_type||null,data_size:e.data_size||null,bandwidth:e.bandwidth||null},media:{duration:h.duration||null,width:h.width||null,height:h.height||null,tags:h.tags?h.tags.join(","):null,creation_type:h.creation_type||null,hd:h.width&&h.height&&h.width*h.height>=921600}}},track:function(a,b,c,d,e,f){try{var g=this._generateEvent(a,b,c,d,e,f);this.application.data.get("analytics")&&this.__queue.push(g),this.__google_analytics_events[b]&&ga("send","event","Ziggeo",b,"Ziggeo Campaign",d.media_time||e.duration||d.data_size||void 0),this.trigger("track",g)}catch(h){}},userTrack:function(a){this.track("2",a)},__pushEvents:function(){if(this.application.data.get("analytics")&&0!==this.__queue.length&&!(this.__trackFailed>10&&this.__trackSuccess/this.__trackFailed<.5)){var a=this.__queue;this.__queue=[],this.application.connect.rawRequest(this.application.urls.analyticsUrl(),{data:{events:JSON.stringify(a)},method:"POST",sendContentType:!0}).error(function(){this.__trackFailed++,this.__queue=a.concat(this.__queue)},this).success(function(){this.__trackSuccess++},this)}}}}])}),Scoped.define("module:Application",["base:Class","base:Objs","base:Events.EventsMixin","base:Events.Events","base:Async","browser:Dom","module:Locale","private:Application.Data","private:Application.Urls","private:Application.Connect","private:Application.Videos","private:Application.Streams","private:Application.Analytics","private:Application.Debugger","module:Supplementary"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){return g.mainLocale.register({error_503:"We are maintaining our service. Videos will be back soon.",error_404:"We cannot recognize your api key. Please make sure to specify it in your website's header.",error_401:"You are not allowed to access the application from this site.",error_412:"You need to confirm / upgrade your account.",error_unknown:"An unknown error occurred. Our team has been notified and will resolve the issue."},"application"),a.extend({scoped:p},[c,function(a){return{constructor:function(b){a.constructor.call(this),this.data=this.auto_destroy(new h(this,b)),this.data.get("debug")&&(this.debug=this.auto_destroy(new n(this))),this.urls=this.auto_destroy(new i(this)),this.connect=this.auto_destroy(new j(this)),this.videos=this.auto_destroy(new k(this)),this.streams=this.auto_destroy(new l(this)),this.analytics=this.auto_destroy(new m(this)),this.embed_events=this.auto_destroy(new d),this.embed_events._invokeCallback=o.eventInvokeCallback,this._invokeCallback=o.eventInvokeCallback,this.cls.register(this),this.__init()},destroy:function(){this.cls.unregister(this),a.destroy.call(this)},__init:function(){this.connect.request("session",{method:"POST",params:{noauth:!this.data.get("auth")}}).success(function(a){this.data.set("cookie_changed",a.token!==this.data.get("cookie_value")),this.data.set("cookie_value",a.token),this.data.set("testing_application",a.testing_application),this.data.set("ready",!0),this.analytics.track("2","init_application",{}),f.ready(function(){e.eventually(function(){this.persistentTrigger("ready")},this)},this)},this).error(function(a){this.data.set("error",a.status_code());var b=g.mainLocale.get("error_"+a.status_code(),"application");this.data.set("error_message",b||g.mainLocale.get("error_unknown","application")),this.persistentTrigger("error",a.status_code(),this.data.get("error_message"))},this)}}}],{__default:null,__instances:{},__deferred:0,events:new d,setDefault:function(a){this.__default=a,this.events.trigger("set-default",a)},getDefault:function(){return this.__default},getByToken:function(a){return this.__instances[a]},instanceByToken:function(a,c){return this.getByToken(a)||new this(b.extend({token:a},c))},register:function(a){var b=a.data.get("token");if(b in this.__instances)throw"Application Instance already existing for this application token.";this.__instances[b]=a,this.__default||this.setDefault(a)},unregister:function(a){var b=a.data.get("token");this.__instances[b]===a&&delete this.__instances[b],this.getDefault()===a&&this.setDefault(null)},isDeferred:function(){return this.__deferred>0},defer:function(){this.__deferred++},undefer:function(){this.__deferred--,0===this.__deferred&&this.events.trigger("undefer")},onUndefer:function(a,b){this.isDeferred()?this.events.once("undefer",a,b):a.call(b||this)}})}),Scoped.define("private:Application.Connect",["base:Class","base:Ajax.AjaxWrapper"],["browser:Ajax.IframePostmessageAjax","browser:Ajax.JsonpScriptAjax","browser:Ajax.XDomainRequestAjax","browser:Ajax.XmlHttpRequestAjax"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c){a.constructor.call(this),this.application=c,this.ajax=new b({sendContentType:!1,contentType:"urlencoded",wrapStatus:!0,wrapStatusParam:"_wrapstatus",noCache:!0,noCacheParam:"_nocache"})},destroy:function(){this.ajax.destroy(),a.destroy.call(this)},rawRequest:function(a,b){return this.ajax.execute({method:b.method,data:b.data,uri:a,resilience:b.resilience,sendContentType:b.sendContentType})},request:function(a,b){return this.rawRequest(this.application.urls.apiResourceUrl(a,b),b)}}})}),Scoped.define("private:Application.Data",["base:Properties.Properties","base:Objs","browser:Cookies","private:Core","browser:Upload.FileUploader","dynamics:Parser"],["browser:Upload.ChunkedFileUploader"],function(a,b,c,d,e,f,g){return a.extend({scoped:g},function(a){return{constructor:function(b,e){if(a.constructor.call(this),e=e||{},this.set("token",e.token),!this.get("token"))throw"You need to specify an application token when creating an application";this.set("webrtc_streaming","boolean"==typeof e.webrtc_streaming&&e.webrtc_streaming),this.set("webrtc_streaming_if_necessary","boolean"==typeof e.webrtc_streaming_if_necessary&&e.webrtc_streaming_if_necessary),this.set("webrtc_on_mobile","boolean"==typeof e.webrtc_on_mobile&&e.webrtc_on_mobile),this.set("cdn","boolean"!=typeof e.cdn||e.cdn),this.set("resumable",!1),this.set("auth","boolean"==typeof e.auth&&e.auth),this.set("analytics","boolean"!=typeof e.analytics||e.analytics),this.set("google_analytics","boolean"==typeof e.google_analytics&&e.google_analytics),this.set("google_analytics_track","undefined"!=typeof e.google_analytics_track?e.google_analytics_track:["init_application","embedding_loaded","record_start","record_end","rerecord_confirm","upload_start"]),this.compute("cookie_key",function(){return d.models.session_cookie_prefix+this.get("token")},["token"]),this.set("cookie_value",this.get("auth")?c.get(this.get("cookie_key")):""),this.on("change:cookie_value",function(a){this.get("auth")&&c.set(this.get("cookie_key"),a)},this),this.set("testing_application",!1),this.set("debug","debug"in e&&void 0!==e.debug?e.debug:d.revision.prerelease),this.set("chrome_extension_id",e.chrome_extension_id),this.set("opera_extension_id",e.opera_extension_id),this.set("chrome_extension_install_link",e.chrome_extension_install_link),this.set("opera_extension_install_link",e.opera_extension_install_link),e.disable_secure_templates&&(f.secureMode=!1)},getUploaderConfig:function(a,c,d){var e={url:a,serverSupportPostMessage:!0,resilience:5,serverSupportsChunked:this.get("resumable"),identifierParameter:"resumableIdentifier",chunks:{chunkNumberParameter:"resumableChunkNumber"},assembly:{fileNameParameter:"resumableFilename",totalSizeParameter:"resumableTotalSize",chunkNumberParameter:"resumableChunkNumber",fileTypeParameter:"resumableType"}};return c&&(e.source=c),b.extend(e,d)},getUploader:function(a,b,c){return e.create(this.getUploaderConfig(a,b,c))}}})}),Scoped.define("private:Application.Debugger",["base:Class","base:Timers.Timer","browser:Events"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(d){a.constructor.call(this),this.application=d,this.__events=this.auto_destroy(new c),this.__events.on(window,"error",function(a){this.__logError({message:a.message,source:a.filename,lineno:a.lineno,colno:a.colno,time:a.timeStamp})},this),this.__queue=[],this.__quota=25,this.__timer=this.auto_destroy(new b({context:this,fire:this.__pushErrors,delay:5e3}))},__logError:function(a){this.__queue.length>=this.__quota||this.__queue.push(a)},__pushErrors:function(){if(0!==this.__queue.length){var a=this.__queue;this.__queue=[],this.__quota-=a.length,this.application.connect.request("/debugger",{data:{events:JSON.stringify(a)},method:"POST"})}}}})}),Scoped.define("private:Application.Streams",["base:Class","base:Objs","private:Application.StreamsApiMixin","browser:Upload.MultiUploader"],function(a,b,c,d,e){return a.extend({scoped:e},[c,function(a){return{constructor:function(b){a.constructor.call(this),this.application=b},imageUrl:function(a,b,c){c=c||{};var d="videos/"+a+"/streams/"+b+"/image";return this.application.urls.streamingResourceUrl(d,{auth:c.auth,params:c.params})},videoUrl:function(a,b,c){c=c||{};var d="videos/"+a+"/streams/"+b+"/"+(c.download?"download_video.mp4":"video.mp4");return this.application.urls.streamingResourceUrl(d,{auth:c.auth,params:c.params})},videoAttachUrl:function(a,b,c){return this.application.urls.apiResourceUrl("/videos/"+a+"/streams/"+b+"/videoattach",{auth:c})},videoAttachUploaderConfig:function(a,b,c,d){return this.application.data.getUploaderConfig(this.videoAttachUrl(a,b,c),d)},videoAttachUploader:function(a,b,c,d){return this.application.data.getUploader(this.videoAttachUrl(a,b,c),d)},imageAttachUrl:function(a,b,c){return this.application.urls.apiResourceUrl("/videos/"+a+"/streams/"+b+"/imageattach",{auth:c})},imageAttachUploaderConfig:function(a,b,c,d){return this.application.data.getUploaderConfig(this.imageAttachUrl(a,b,c),d,{nonessential:!1})},imageAttachUploader:function(a,b,c,d){return this.application.data.getUploader(this.imageAttachUrl(a,b,c),d,{essential:!1})},audioAttachUrl:function(a,b,c){return this.application.urls.apiResourceUrl("/videos/"+a+"/streams/"+b+"/audioattach",{auth:c})},subtitleAttachUrl:function(a,b,c){return this.application.urls.apiResourceUrl("/videos/"+a+"/streams/"+b+"/subtitleattach",{auth:c})},audioAttachUploaderConfig:function(a,b,c,d){return this.application.data.getUploaderConfig(this.audioAttachUrl(a,b,c),d)},subtitleAttachUploaderUrl:function(a,b,c){return this.subtitleAttachUrl(a,b,c)},audioAttachUploader:function(a,b,c,d){return this.application.data.getUploader(this.audioAttachUrl(a,b,c),d)},rtmpStreamName:function(a,b,c){return this.application.urls.resourceUrl("applications/"+this.application.data.get("token"),"/videos/"+a+"/streams/"+b+"/video.mp4",{auth:c})},webrtcStreamName:function(a,b,c){return"applications___"+this.application.data.get("token")+"___videos___"+a+"___streams___"+b+"___video"},dataUploader:function(a,b,c){var e=new d;return c.video_data&&e.addUploader(this.videoAttachUploader(a,b,c.auth,c.video_data)),c.audio_data&&e.addUploader(this.audioAttachUploader(a,b,c.auth,c.audio_data)),c.image_data&&e.addUploader(this.imageAttachUploader(a,b,c.auth,c.image_data)),e}}}])}),Scoped.define("private:Application.Urls",["base:Class","base:Objs","base:Sort","base:Types","base:Comparators","base:Net.Uri","base:Async","browser:Info","media:Flash.Support","media:WebRTC.RecorderWrapper","private:Environment"],function(a,b,c,d,e,f,g,h,i,j,k,l){return a.extend({scoped:l},function(a){return{constructor:function(b){a.constructor.call(this),this.application=b,this.__servers=k.serversByToken(this.application.data.get("token")),this.__rtmpConnectivityResults={}},httpApiBaseUrl:function(){return(k.sslRequired?"https":"http")+"://"+this.__servers["embed.api.server.public.domain"]},analyticsApiBaseUrl:function(){return(k.isLocal?"http":"https")+"://"+this.__servers["analytics.api.server.public.domain"]},httpStreamingBaseUrl:function(){return(k.sslRequired?"https":"http")+"://"+this.__servers[this.application.data.get("cdn")?"embed-cdn.api.server.public.domain":"embed.api.server.public.domain"]},rtmpRecordingUrls:function(){var a=[];return a.push("rtmp://"+this.__servers["wowza.api.record.rtmp.domain"]+"/"+this.__servers["wowza.api.record.rtmp.path"]),k.isLocal?(a.push("rtmp://"+this.__servers["wowza.api.record.rtmp.domain"]+":1936/"+this.__servers["wowza.api.record.rtmp.path"]),a.push("rtmpt://"+this.__servers["wowza.api.record.rtmp.domain"]+":1936/"+this.__servers["wowza.api.record.rtmp.path"])):(a.push("rtmp://"+this.__servers["wowza.api.record.rtmp.domain"]+":80/"+this.__servers["wowza.api.record.rtmp.path"]),a.push("rtmps://"+this.__servers["wowza.api.record.rtmp.domain"]+":443/"+this.__servers["wowza.api.record.rtmp.path"]),a.push("rtmpt://"+this.__servers["wowza.api.record.rtmp.domain"]+":80/"+this.__servers["wowza.api.record.rtmp.path"])),a.push("rtmpt://"+this.__servers["wowza.api.record.rtmp.domain"]+"/"+this.__servers["wowza.api.record.rtmp.path"]),a.filter(function(a){return this.__rtmpConnectivityResults[a]>0},this).concat(a.filter(function(a){return!this.__rtmpConnectivityResults[a]},this)).concat(a.filter(function(a){return this.__rtmpConnectivityResults[a]<0},this))},registerRtmpConnectivityResult:function(a,b){this.__rtmpConnectivityResults[a]=b},rtmpRecordingUrl:function(){var a=this.rtmpRecordingUrls();return a[0]},webrtcStreamingApp:function(a){return this.__servers["wowza.api.record.webrtc.app"]+(a||"")},wssUrl:function(){return this.__servers["wowza.api.record.webrtc.wssurl"]},httpApiAppUrl:function(){return this.httpApiBaseUrl()+"/v1/applications/"+this.application.data.get("token")},analyticsUrl:function(){return this.analyticsApiBaseUrl()+"/embed/v1/applications/"+this.application.data.get("token")+"/scitylana/kcart"},apiResourceUrl:function(a,c){return this.resourceUrl(this.httpApiAppUrl(),a,b.extend({auth:!0},c))},httpStreamingAppUrl:function(){return this.httpStreamingBaseUrl()+"/v1/applications/"+this.application.data.get("token")},streamingResourceUrl:function(a,b){return this.resourceUrl(this.httpStreamingAppUrl(),a,b)},urlParams:function(a){a=a||{};var d=b.extend({},b.filter(a.params,function(a,b){return null!==a&&""!==a}));return a.auth&&this.application.data.get("auth")&&(d=b.extend(d,b.filter(a.auth,function(a,b){return null!==a&&""!==a})),d[this.application.data.get("cookie_key")]=this.application.data.get("cookie_value")),c.sort_object(d,e.byValue)},hostedBaseUrl:function(){return(k.sslRequired?"https":"http")+"://"+this.__servers["hosted.pages.server.public.domain"]},hostedUrl:function(a){return this.hostedBaseUrl()+a},resourceUrl:function(a,b,c){return f.appendUriParams(a+(b&&0!==b.indexOf("/")?"/":"")+b,this.urlParams(c))}}})}),Scoped.define("private:Application.Videos",["base:Class","base:Promise","base:Objs","base:Time","base:Async","base:Net.HttpHeader","base:Ids","base:Comparators","private:Application.VideosApiMixin"],function(a,b,c,d,e,f,g,h,i,j){return a.extend({scoped:j},[i,function(a){return{constructor:function(b){a.constructor.call(this),this.application=b,this.__cache={}},imageUrl:function(a,b){b=b||{};var d="videos/"+a+"/image";return this.application.urls.streamingResourceUrl(d,{auth:b.auth,params:c.extend({refresh:this.refreshToken(a)},b.params)})},publicVideoUrl:function(a){return this.application.urls.hostedUrl("/v/"+a)},videoUrl:function(a,b){b=b||{};var d="videos/"+a+"/"+(b.download?"download_video.mp4":"video.mp4");return this.application.urls.streamingResourceUrl(d,{auth:b.auth,params:c.extend({refresh:this.refreshToken(a)},b.params)})},refreshToken:function(a){try{var b=this.cache(a,{weak:!0}).value();if(!b||b.submission_date===b.resubmission_date)return null;var c=d.now()/1e3-b.resubmission_date;return c>86400?null:b.resubmission_date}catch(e){return null}},__cacheGet:function(a){return this.__cache[a]||(this.__cache[a]={ready:!1,data:null,error:null,last_update:null,auth:null,next_update:null,next_update_timer:null,updating:!1,promises:[],watchers:{}}),this.__cache[a]},__cacheUpdate:function(a,b){var f=this.__cacheGet(a);if(!(f.updating||f.next_update&&f.next_update<=b)){f.next_update&&(e.clearEventually(f.next_update_timer),f.next_update=null);var g=d.now();if(g<b)return f.next_update=b,void(f.next_update_timer=e.eventually(function(){this.__cacheUpdate(a)},this,b-g));f.updating=!0,this.get(a,f.auth).callback(function(b,g){f.ready=!0,f.updating=!1;var i=d.now(),j=f.last_update?i-f.last_update:null;f.last_update=i,f.next_update=null;var k=f.data,l=b;f.data=g,f.error=b,e.clearEventually(f.next_update_timer),c.iter(f.promises,function(a){a.asyncCallback(b,g)},this),(b&&!b.equals(l)||!h.deepEqual(g,k,10))&&c.iter(f.watchers,function(a){a.callback.call(a.context,b,g)},this),null===j?c.iter(f.watchers,function(a){a.weak||(j=null===j?a.initialage:Math.min(a.initialage,j))},this):j*=2,null!==j&&(c.iter(f.watchers,function(a){!a.weak&&a.maxage&&(j=Math.min(j,a.maxage))},this),this.__cacheUpdate(a,i+j))},this)}},cacheInvalidate:function(a){this.__cacheGet(a).ready=!1},cache:function(a,d){var e=this.__cacheGet(a);if(d=c.extend({auth:null,weak:!1,force:!1,age:null},d),d.weak&&!e.ready)return b.error(!0);if(e.ready&&!d.force&&(!d.age||now-e.last_update<d.age))return e.data?b.value(e.data):b.error(e.error);d.auth&&(e.auth=d.auth);var f=b.create();return e.promises.push(f),this.__cacheUpdate(a),f},watch:function(a,b,e,f){var h=this.__cacheGet(a);b=c.extend({auth:null,weak:!1,maxage:null,initialage:1e3},b),b.auth&&(h.auth=b.auth),h.watchers[g.objectId(f)]={context:f,callback:e,weak:b.weak,maxage:b.maxage,age:b.initialage},b.weak||this.__cacheUpdate(a,b.initialage+d.now())},unwatch:function(a,b){var c=this.__cacheGet(a);delete c.watchers[g.objectId(b)]},createByUpload:function(a){return this.create(c.extend(c.clone(a.data,1),{create_stream:!0}),a.auth).mapSuccess(function(c){var d=b.create(),e=this.application.streams.dataUploader(c.video.token,c.stream.token,{auth:a.auth,video_data:a.video_data,audio_data:a.audio_data,image_data:a.image_data});return a.progress&&e.on("progress",a.progress,a.context),e.on("error",function(a){d.asyncError(a)},this),e.on("success",function(){this.application.streams._recorder_submit(c.video.token,c.stream.token,null,a.auth,50).forwardCallback(d)},this),e.upload(),d},this)}}}])}),Scoped.define("module:Config",["private:Environment","base:Properties.Properties","base:Functions","flash:"],function(a,b,c,d){var e=new b,f=function(a,b,c){c(b),e.set(a,b),e.on("change:"+a,function(a){c(a)})};return f("flash",a.assetsBase+"ziggeo.swf",function(a){d.options=d.options||{},d.options.flashFile=a}),{set:c.as_method(e.set,e),get:c.as_method(e.get,e)}}),Scoped.define("module:Device",["base:Events.Events","base:Functions","base:Async","base:Promise","media:Recorder.WebRTCVideoRecorderWrapper","media:Recorder.FlashVideoRecorderWrapper","media:WebRTC.Support","media:Flash.Support","browser:Info","private:Core"],function(a,b,c,d,e,f,g,h,i,j){var k=function(a,b){try{return a()}catch(c){return b||!1}},l=new a,m=function(){return{location:document.location.href,userAgent:navigator.userAgent,flash:i.formatFlash(),device:i.formatDevice(),os:i.formatOS(),browser:i.formatBrowser(),version:i.formatBrowserVersion(),revision:j.revision}},n={info:k(m,{}),on:b.as_method(l.on,l),webrtc:k(function(){return e.supported({})}),flash:k(function(){return f.supported({})}),cameras:null,microphones:null,camera_count:null,microphone_count:null},o=function(a){n.devices=a,n.cameras=a.video,n.microphones=a.audio,n.camera_count=a.videoCount,n.microphone_count=a.audioCount,l.persistentTrigger("device_info",n.cameras,n.microphones,n.camera_count,n.microphone_count),l.persistentTrigger(n.camera_count>0?"has_camera":"no_camera"),l.persistentTrigger(n.microphone_count>0?"has_microphone":"no_microphone")},p=function(){n.devices=null,l.persistentTrigger("device_error")};return n.media=function(){if("devices"in n)return n.devices?d.value(n.devices):d.error("failed");var a=d.create();try{g.enumerateMediaSources().success(function(b){a.asyncSuccess(b),o(b)}).error(function(){try{h.enumerateMediaSources().success(function(b){a.asyncSuccess(b),o(b)}).error(function(){a.asyncError("failed"),p()})}catch(b){a.asyncError("failed"),p()}})}catch(b){try{h.enumerateMediaSources().success(function(b){a.asyncSuccess(b),o(b)}).error(function(){a.asyncError("failed"),p()})}catch(b){a.asyncError("failed"),p()}}return a},n}),Scoped.define("private:Environment",["private:Logger","private:Core","browser:Info","browser:Loader","base:Objs","base:Types","base:Net.Uri"],function(a,b,c,d,e,f,g){b.revision.prerelease&&a.warn("You are currently using a prerelease version of the Ziggeo JS SDK. We suggest using the stable revision for production use, and prereleases for staging environments and tests only.");var h=!!Scoped.getGlobal("ZiggeoLocal")||!!Scoped.getGlobal("ZiggeoWeb")&&location.hostname.indexOf("ziggeo.com")===-1,i=!1;if(!h)try{i=location.protocol.indexOf("https")!=-1||0===location.protocol.indexOf("file")||c.isCordova()}catch(j){}try{0!==location.protocol.indexOf("file")||c.isCordova()||a.warn("In order to use Ziggeo's recording technology, this page needs to be served via https (for WebRTC) and at least via http (for Flash). The file:// protocol is not supported. For more details contact us at support@ziggeo.com")}catch(j){}try{0===location.protocol.indexOf("https")?window.location!=window.parent.location&&0===document.referrer.indexOf("https")&&a.warn("Accessing the camera and the microphone on insecure origins (HTTP) is deprecated, and future browser versions will stop to support insecure origins. We highly recommend upgrading to SSL (HTTPS). For more details contact us at support@ziggeo.com"):0===location.protocol.indexOf("http")&&a.warn("Accessing the camera and the microphone on insecure origins (HTTP) is deprecated, and future browser versions will stop to support insecure origins. We highly recommend upgrading to SSL (HTTPS). For more details contact us at support@ziggeo.com")}catch(j){}var k=!h,l=h||!!Scoped.getGlobal("ZiggeoDev")||!!Scoped.getGlobal("ZiggeoWeb")&&k&&location.hostname.indexOf("dev")!==-1,m=!l,n=h?"local":m?"production":"development",o=e.clone(b.servers[n],1),p=function(a){var b=e.clone(o,-1);return e.iter(o.regions,function(c){0===a.indexOf(c.prefix)&&(b=e.extend(b,c))}),b},q={};if(m&&(q.cdn=o["assets-cdn.api.server.public.domain"]),q.normal=o["assets.api.server.public.domain"],h)try{window.location.hostname&&/^\d+\.\d+\.\d+\.\d+$/.test(window.location.hostname)&&(o=e.map(o,function(a){return f.is_string(a)?a.replace("localhost",window.location.hostname):a}),q.local=o["assets.api.server.public.domain"])}catch(j){}var r=o["assets.api.server.public.domain"],s=!1,t="/v"+b.revision.version+"-r"+b.revision.revision+"/",u=i?"https":"http",v=null;m&&(r=o["assets-cdn.api.server.public.domain"],s=!0);for(var w in q)try{var x=q[w],y=d.findScript(x);if(y&&y.src.indexOf("ziggeo.js")!==-1){s="cdn"===w;var z=g.parse(y.src);u=i?"https":z.protocol,r=z.host,z.port&&(r+=":"+z.port),t=z.directory;break}}catch(j){}v||(v=u+"://"+r+t);var A={isLocal:h,isServer:k,isDevelopment:l,isProduction:m,environment:n,serverEnvironments:b.servers,servers:o,serversByToken:p,assetsDomain:r,assetsCdn:s,assetsPath:t,assetsBase:v,sslRequired:i};return A}),Scoped.define("module:Locale",["base:Classes.LocaleAggregator","base:Classes.LocaleTable","browser:Info","mediacomponents:Assets"],function(a,b,c,d){var e=new a,f=new b;return e.register(f),e.register(d.strings),e.setWeakLocale(c.language()),{setLocale:function(a){e.setLocale(a)},mainLocale:f,mediaLocale:d.strings}}),Scoped.define("private:Logger",[],function(){return{__console:function(a,b){try{console&&console[a]&&console[a].apply(console,b)}catch(c){}return this},warn:function(){return this.__console("warn",arguments)},log:function(){return this.__console("log",arguments)}}}),Scoped.define("module:Ads",["mediacomponents:Ads.AdSenseVideoAdProvider","mediacomponents:Ads.VastVideoAdProvider"],function(a,b){return{AdSenseVideoAdProvider:a,VastVideoAdProvider:b}}),Scoped.define("module:Supplementary",["base:Async"],function(a){return{eventInvokeCallback:function(b,c,d){try{b.apply(c,d)}catch(e){a.eventually(function(){throw e})}}}}),Scoped.define("private:Dynamics",["dynamics:DomObserver","dynamics:Parser","dynamics:Registries","base:Async","browser:Dom","module:Application"],function(a,b,c,d,e,f){b.secureMode=!0,c.prefixes.ziggeo=!0;var g=new a({allowed_dynamics:["ziggeoplayer","ziggeorecorder"],enabled:!1});return e.ready(function(){d.eventually(function(){f.onUndefer(function(){g.enable()})})}),{domObserver:g}}),Scoped.define("module:Player",["mediacomponents:VideoPlayer.Dynamics.Player","private:Logger","module:Application","base:Types","module:PlayerStates","base:Net.HttpHeader","module:Locale","module:Supplementary","base:Objs","base:Time","base:Promise","base:TimeFormat"],function(a,b,c,d,e,f,g,h,i,k,l,m,n){return a.extend({scoped:n},function(a){return{attrs:{"stream-width":null,"stream-height":null,"effect-profile":null,"client-auth":null,"server-auth":null,"intermediate-token":null,video:null,stream:null,application:null,forcerefresh:!1,pauseonplay:!1,"audio-transcription-as-subtitles":!1
},types:{playlist:"array",pauseonplay:"bool","lazy-application":"bool","audio-transcription-as-subtitles":"bool"},create:function(){return this._invokeCallback=h.eventInvokeCallback,this.get("source")||this.get("sources").length>0?a.create.call(this):(this.set("ready",!1),this.__playlist=this.get("playlist"),this.set("playlist",null),this.get("effect-profile")&&d.is_array(this.get("effect-profile"))&&this.set("effect-profile",this.get("effect-profile")[0]),a.create.call(this),this.set("auth",{client_auth:this.get("client-auth"),server_auth:this.get("server-auth"),intermediate_token:this.get("intermediate-token")}),this.set("application_status",null),void this.set("video_status",null))},_notifications:{_activate:"_createWithApplication"},_obtainApplication:function(){this.get("application")&&(this.application=d.is_string(this.get("application"))?c.instanceByToken(this.get("application")):this.get("application")),this.application=this.application||c.getDefault()},_deferActivate:function(){return this._obtainApplication(),!(this.application||!this.get("lazy-application"))&&(c.events.once("set-default",function(a){this.application=a,this.activate()},this),!0)},_createWithApplication:function(){if(this._obtainApplication(),!this.application)return void b.warn("No application (token) defined. We need an application (token) to include an embedding.");if(!this.application.data.get("auth")&&(this.get("client-auth")||this.get("server-auth")))return void b.warn("You are specifying auth tokens on your embedding yet your application is initialized with auth = false.");if(this.application.embed_events.delegateEvents(null,this,null,[this]),this.__playlist){this.set("playlist",this.__playlist.map(function(a){return this.__sourceByVideo(a)},this));var a=this.get("playlist")[0];this.set("poster",a.poster),this.set("source",a.source),this.set("video",a.token),this.on("playlist-next",function(a){this.set("video",a.token)},this)}this.application.on("ready",function(){this.set("application_status",!0),this.get("playlist")?this.set("ready",!0):(this.get("source")||this.__setVideoSources(),this.set("ready",!0)),this._track("embedding_loaded")},this).on("error",function(a,b){this.set("application_status",!1),this.state().next("FatalError",{message:b})},this),this.get("pauseonplay")&&this.application.embed_events.on("playing",function(a){a!==this&&this.get("playing")&&this.execute("pause")},this)},destroy:function(){this.application.embed_events.off(null,null,this),a.destroy.call(this)},events:{"change:video":function(){this.set("stream",null),this.__setVideoSources()},paused:function(){this._track("play_pause",{media_time:this.get("position")})},playing:function(){this._track("play_playing",{media_time:this.get("position")})},ended:function(){this._track("play_end",{media_time:this.get("duration")})},seek:function(a){this._track("play_seek",{media_time:a})}},__setVideoSources:function(){this.get("video")&&this.get("application_status")&&(this.set("sharevideourl",this.application.videos.publicVideoUrl(this.get("video")).replace("http://","https://")),this.get("stream")||this.set("refresh_token",this.application.videos.refreshToken(this.get("video"))),this.__setSources(),this.application.videos.cache(this.get("video"),{auth:this.get("auth")}).callback(this.__videoUpdate,this),this.get("ready")&&this.reattachVideo())},__sourceByVideo:function(a,b){var c=this.get("video_data"),d=i.filter(c&&c.streams?c.streams:[],function(a){return!(a.token!==c.original_stream.token&&a.parent_stream!==c.original_stream.token||5!==a.state||3!==a.streamable||this.get("effect-profile")&&a.effect_profile!==this.get("effect-profile"))},this);if(this.get("playlist")&&(d=[],b=null),b||this.get("stream-width")||this.get("stream-height")||d.length<2){var e=b?this.application.streams:this.application.videos,f=[a];return b&&f.push(b),f.push({auth:this.get("auth"),params:{stream_width:this.get("stream-width"),stream_height:this.get("stream-height"),effect_profile:this.get("effect-profile"),force_refresh:this.get("forcerefresh")}}),{poster:e.imageUrl.apply(e,f),source:e.videoUrl.apply(e,f),token:a}}var g=[],h=[],j={effect_profile:this.get("effect-profile"),force_refresh:this.get("forcerefresh"),auth:this.get("auth")};i.iter(d,function(b){g.push({src:this.application.streams.videoUrl(a,b.token,j),poster:this.application.streams.imageUrl(a,b.token,j),token:b.token}),h.push({width:b.video_width,height:b.video_height,filter:{token:b.token}})},this);var k=h[0];return{poster:null,source:null,sources:g,streams:h,currentstream:k,token:a}},__setSources:function(){this.set("uploadoptions",{textTracks:this.application.streams.subtitleAttachUploaderUrl(this.get("video"),this.get("stream")||this.properties().getProp("video_data.original_stream.token"),this.get("auth"))}),this.setAll(this.__sourceByVideo(this.get("video"),this.get("stream")))},__audioTranscriptionToVTT:function(a,b,c){c=c||5;for(var d=a.length,e=0,f=["WEBVTT"];e<d;){var g=b[e].start,h=b[e].end,i=[a[e]];for(e++,j=c-1;j>0&&e<d;)h=b[e].end,i.push(a[e]),e++,j--;f.push(""),f.push(m.format("HH:MM:ss.l",g)+" --> "+m.format("HH:MM:ss.l",h)),f.push(i.join(" "))}return f.join("\n")},__videoUpdate:function(a,b){if(!this.destroyed())if(a)this.set("video_status",!1),a.status_code()===f.HTTP_STATUS_NOT_FOUND?this.state().next("FatalError",{message:this.string("video-not-found")}):a.status_code()===f.HTTP_STATUS_FORBIDDEN?this.state().next("FatalError",{message:this.string("video-access-forbidden")}):this.state().next("FatalError",{message:this.string("video-unknown-error")});else{this.set("video_data",b);var c=[];try{var d=b.default_stream.audio_transcription||b.original_stream.audio_transcription;d&&this.get("audio-transcription-as-subtitles")&&c.push({lang:"en",kind:"subtitles",label:"Transcription",content:this.__audioTranscriptionToVTT(d.words,d.times)});var e=b.default_stream.subtitles||b.original_stream.subtitles;e&&i.iter(e,function(a,b){c.push({lang:b,kind:"subtitles",label:a.label,content:a.data})})}catch(g){}if(this.set("tracktags",c),this.get("title")||this.set("title",b.title),this.set("totalduration",b.duration),b.approved===!1&&!this.get("intermediate-token"))return void this.state().next("FatalError",{message:b.moderation_reason||this.string("video-rejected")});if(b.state<4)return void this.state().next("FatalError",{message:this.string("video-unknown-error")});if(this.set("video_status",!0),4===b.state)return void("VideoProcessing"!==this.state().state_name()&&this.state().next("VideoProcessing"));if(this.get("effect-profile")){var h=!1;if(i.iter(b.streams,function(a){a.effect_profile===this.get("effect-profile")&&a.state>4&&(h=!0)},this),!h)return void("VideoProcessing"!==this.state().state_name()&&this.state().next("VideoProcessing"));if("VideoProcessing"===this.state().state_name())return this.set("forcerefresh",k.now()),this.__setSources(),void this.state().next("LoadPlayer")}if("VideoProcessing"===this.state().state_name())return this.set("refresh_token",this.application.videos.refreshToken(this.get("video"))),this.set("forcerefresh",k.now()),this.__setSources(),void this.state().next("LoadPlayer");if(!this.get("stream")&&!this.get("refresh_token")&&this.application.videos.refreshToken(this.get("video")))return this.set("refresh_token",this.application.videos.refreshToken(this.get("video"))),this.__setSources(),void this.state().next("LoadPlayer");this.__setSources()}},_track:function(a,b,c){if(this.application){var d=k.now(),e=l.create();e.success(function(){this.application.analytics.track("2",a,{video_token:this.get("video_data").token,stream_token:this.get("stream")?this.get("stream"):void 0},i.extend({embed_type:"player"},b),i.extend({duration:this.get("video_data").duration||this.get("duration"),width:this.get("stream")?this.get("stream").width:this.videoWidth(),height:this.get("stream")?this.get("stream").height:this.videoHeight(),tags:this.get("video_data").tags},c),d)},this),this.get("video_data")?e.asyncSuccess():this.once("change:video_data",function(){e.asyncSuccess()},this)}}}},function(a){return{playerStates:function(){return a.playerStates.call(this).concat([e])}}}).register("ba-ziggeoplayer").register("ziggeoplayer").attachStringTable(g.mainLocale).addStrings({"video-not-found":"We could not find the specified video file.","video-access-forbidden":"You are not permitted to access this video file.","video-unknown-error":"We cannot access this video at the moment. Please try again later.","video-rejected":"The video has been rejected.","video-processing":"The video is processing - stay tuned.","video-access-error":"The video is currently under moderation. You may click to retry."})}),Scoped.define("module:PopupPlayer",["module:Player","mediacomponents:PopupHelper"],function(a,b,c){return a.extend({scoped:c},b.mixin)}),Scoped.define("module:PlayerStates.PosterError",["mediacomponents:VideoPlayer.Dynamics.PlayerStates.State"],function(a,b){return a.extend({scoped:b},{dynamics:["loader"],_fail:function(){return 4===this.dyn.get("video_data").state?void this.next("VideoProcessing"):(this.dyn.set("loader_active",!1),this.dyn.set("message_active",!0),this.dyn.set("message",this.dyn.string("video-access-error")),void this.listenOn(this.dyn,"message:click",function(){this.next("LoadPlayer")},this))},_started:function(){this.dyn.get("video_status")===!0&&this._fail(),this.listenOn(this.dyn,"change:video_status",function(){this.dyn.get("video_status")===!0&&this._fail()})}})}),Scoped.define("module:PlayerStates.VideoProcessing",["mediacomponents:VideoPlayer.Dynamics.PlayerStates.State","base:Time","base:Timers.Timer"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{dynamics:["loader","message"],_started:function(){this.dyn.set("message",this.dyn.string("video-processing")),this.__video=this.dyn.get("video"),this.dyn.application.videos.watch(this.__video,{auth:this.dyn.get("auth"),maxage:2500},this.dyn.__videoUpdate,this.dyn),this.dyn.set("start-processing-time",b.now()),this.dyn._track("processing_start"),this.auto_destroy(new c({delay:100,context:this,fire:function(){var a=1e3;this.dyn.get("duration")&&this.dyn.get("duration")/60*1e3>1e3&&(a=this.dyn.get("duration")/60*1e3);var c=(b.now()-this.dyn.get("start-processing-time"))/a,d=1-1/(1+Math.sqrt(Math.sqrt(c)));this.dyn.trigger("processing",d),this.dyn.parent()&&this.dyn.parent().trigger("processing",d)}}))},_end:function(){this.dyn.application.videos.unwatch(this.__video,this),this.dyn.set("end-processing-time",b.now()),this.dyn._track("processing_end",{media_time:this.dyn.get("end-processing-time")-this.dyn.get("start-processing-time")}),this.dyn.trigger("processed"),this.dyn.parent()&&this.dyn.parent().trigger("processed"),a._end.call(this)}}})}),Scoped.define("module:PlayerStates.PlayVideo",["mediacomponents:VideoPlayer.Dynamics.PlayerStates.PlayVideo"],function(a,b){return a.extend({scoped:b},function(a){return{_started:function(){a._started.call(this),this.dyn.application&&this.dyn.application.videos._playback(this.dyn.get("video"),null,this.dyn.get("auth")),this.dyn._track("play_start")}}})}),Scoped.define("module:Recorder",["mediacomponents:VideoRecorder.Dynamics.Recorder","module:Application","module:Device","private:Logger","private:Environment","module:RecorderStates","base:Types","base:Time","base:Strings","module:Locale","module:Supplementary","base:Objs","base:Promise","base:Async","browser:Events","browser:Info"],function(Recorder,Application,Device,Logger,Environment,RecorderStates,Types,Time,Strings,Locale,Supplementary,Objs,Promise,Async,DomEvents,Info,scoped){return Recorder.extend({scoped:scoped},function(a){return{template:a.template.replace('"overlay">','"overlay"><a class="ziggeo-v2-testing" ba-if="{{testing}}" href="https://ziggeo.com/pricing" target="_blank"></a>'),attrs:{dynvideoplayer:"ziggeoplayer","effect-profile":null,"preview-effect-profile":null,"video-profile":null,"meta-profile":null,"client-auth":null,"server-auth":null,"intermediate-token":null,application:null,video:null,description:null,title:null,tags:null,"custom-data":null,key:null,"auto-crop":null,"auto-pad":null,"expiration-days":null,"force-overwrite":null,"recover-streams":null,"input-bind":null,"form-accept":null,playermodeifexists:!1,rerecordableifexists:!1,chrome_extension_id:null,opera_extension_id:null,chrome_extension_install_link:null,opera_extension_install_link:null},types:{tags:"array","custom-data":"object","auto-crop":"bool","auto-pad":"bool","expiration-days":"int","delete-old-streams":"bool","force-overwrite":"bool","recover-streams":"bool","effect-profile":"array","lazy-application":"bool",playermodeifexists:"bool",rerecordableifexists:"bool"},events:{rerecord:function(){this.__inputBindElement&&(this.__inputBindElement.value=""),this.get("form-accept")&&this._formAcceptEvents.on(document.querySelector(this.get("form-accept")),"submit",function(a){a.preventDefault()})},processed:function(){this.__had_processed=!0}},create:function(){this._invokeCallback=Supplementary.eventInvokeCallback,this.set("ready",!1),this.set("rtmpstreamtype",Environment.isLocal?"flv":"mp4"),a.create.call(this),this.get("video")&&!this.get("key")&&Strings.starts_with(this.get("video"),"_")&&this.set("key",Strings.strip_start(this.get("video"),"_")),this.get("simulate")&&this.set("localplayback",!0),Types.is_string(this.get("effect-profile"))&&this.set("effect-profile",Types.parseArray(this.get("effect-profile"))),this.set("auth",{client_auth:this.get("client-auth"),server_auth:this.get("server-auth"),intermediate_token:this.get("intermediate-token")}),this.set("application_status",null),this.__hadInitialVideo=!!this.get("video"),this.get("video")||(this.set("playermodeifexists",!1),this.set("rerecordableifexists",!1),this.get("form-accept")&&(this._formAcceptEvents=this.auto_destroy(new DomEvents),this._formAcceptEvents.on(document.querySelector(this.get("form-accept")),"submit",function(a){a.preventDefault()}))),this.on("rerecord",function(){this._track("rerecord_confirm")},this),this.__had_processed=!1},_notifications:{_activate:"_createWithApplication"},_obtainApplication:function(){this.get("application")&&(this.application=Types.is_string(this.get("application"))?Application.instanceByToken(this.get("application")):this.get("application")),this.application=this.application||Application.getDefault()},_deferActivate:function(){if(this._obtainApplication(),(this.application||!this.get("lazy-application"))&&!this.get("playermodeifexists")&&!this.get("rerecordableifexists"))return!1;var a=Promise.create();return this.application?a.asyncSuccess(!0):Application.events.once("set-default",function(b){this.application=b,a.asyncSuccess(!0)},this),(this.get("playermodeifexists")||this.get("rerecordableifexists"))&&(a=a.mapSuccess(function(){return this.application.videos.get(this.get("video"),{auth:this.get("auth")}).success(function(a){a&&(this.get("playermodeifexists")&&this.set("recordermode",!1),this.get("rerecordableifexists")||this.set("rerecordable",!1))},this)},this)),a.success(this.activate,this),!0},_createWithApplication:function(){return this._obtainApplication(),this.application?this.application.data.get("auth")||!this.get("client-auth")&&!this.get("server-auth")?(this.get("chrome_extension_id")&&!this.get("chrome_extension_install_link")&&this.set("chrome_extension_install_link","https://chrome.google.com/webstore/detail/"+this.get("chrome_extension_id")),this.set("screen",{chromeExtensionId:this.get("chrome_extension_id")||this.application.data.get("chrome_extension_id"),operaExtensionId:this.get("opera_extension_id")||this.application.data.get("opera_extension_id"),chromeExtensionInstallLink:this.get("chrome_extension_install_link")||this.application.data.get("chrome_extension_install_link"),operaExtensionInstallLink:this.get("opera_extension_install_link")||this.application.data.get("opera_extension_install_link")}),this.application.embed_events.delegateEvents(null,this,null,[this]),this.application.on("ready",function(){this.set("application_status",!0),this.set("ready",!0),this.set("testing",this.application.data.get("testing_application"))},this).on("error",function(a,b){this.set("application_status",!1),this.state().next("FatalError",{message:b})},this),this.set("playerattrs",{application:this.application,"effect-profile":this.get("preview-effect-profile"),"client-auth":this.get("client-auth"),"server-auth":this.get("server-auth"),"intermediate-token":this.get("intermediate-token"),video:this.get("video"),"force-refresh":Time.now()}),this._track("embedding_loaded"),this.on("attached",function(){this.recorder.isFlash()&&this.recorder.on("endpoint_connectivity",function(a,b){this.application.urls.registerRtmpConnectivityResult(a.serverUrl,b)},this)},this),this._updateUrls(),this.set("webrtcstreaming",this.application.data.get("webrtc_streaming")),this.set("webrtcstreamingifnecessary",this.application.data.get("webrtc_streaming_if_necessary")),void this.set("webrtconmobile",this.application.data.get("webrtc_on_mobile"))):void Logger.warn("You are specifying auth tokens on your embedding yet your application is initialized with auth = false."):void Logger.warn("No application (token) defined. We need an application (token) to include an embedding.")},_track:function(a,b,c){this.application.analytics.track("2",a,{video_token:this.get("video"),stream_token:this.get("stream")},Objs.extend({embed_type:this.__hadInitialVideo?"rerecorder":"recorder"},b),Objs.extend({creation_type:this.get("creation-type"),duration:this.get("duration"),width:this.get("recordingwidth"),height:this.get("recordingheight"),tags:this.get("tags")},c))},functions:{reset:function(){this.get("video")&&!this.__hadInitialVideo&&this.set("video",null),this.__had_processed=!1,a.functions.reset.call(this)},ready_to_play:function(){this.__had_processed||(this.trigger("processing",1),this.trigger("processed")),a.functions.ready_to_play.call(this)}},_updateUrls:function(){this.set("playerattrs.video",this.get("video"));var a=this.application.streams.rtmpStreamName(this.get("video"),this.get("stream"),this.get("auth"));this.set("uploadoptions",{rtmp:this.application.urls.rtmpRecordingUrls().map(function(b){return{serverUrl:b,streamName:a}}),webrtcStreaming:{wssUrl:this.application.data.get("webrtc_streaming")?this.application.urls.wssUrl():void 0,streamInfo:this.application.data.get("webrtc_streaming")?{applicationName:this.application.urls.webrtcStreamingApp(Info.isFirefox()?"udp":""),streamName:this.application.streams.webrtcStreamName(this.get("video"),this.get("stream"),this.get("auth"))}:void 0,delay:4750,stopDelay:2750},image:this.application.streams.imageAttachUploaderConfig(this.get("video"),this.get("stream"),this.get("auth")),video:Objs.extend({resilienceCheck:function(a){return!a||!a.duration}},this.application.streams.videoAttachUploaderConfig(this.get("video"),this.get("stream"),this.get("auth"))),audio:this.application.streams.audioAttachUploaderConfig(this.get("video"),this.get("stream"),this.get("auth")),textTracks:this.application.streams.subtitleAttachUploaderUrl(this.get("video"),this.get("stream"),this.get("auth"))})},_readDeviceOrientation:function(){var a=window.orientation+90;return a||void 0},__createParams:function(){var a={};try{var b=this.activeElement().cloneNode();b.innerHTML="",a=b.outerHTML}catch(c){}return{description:this.get("description"),title:this.get("title"),tags:this.get("tags")?this.get("tags").join(","):void 0,data:this.get("custom-data")?JSON.stringify(this.get("custom-data")):void 0,key:this.get("key"),auto_crop:this.get("auto-crop"),auto_pad:this.get("auto-pad"),only_audio:this.get("onlyaudio"),expiration_days:this.get("expiration-days"),delete_old_streams:this.get("delete-old-streams"),effect_profile:this.get("effect-profile")?this.get("effect-profile").join(","):void 0,force_overwrite:this.get("force-overwrite"),video_profile:this.get("video-profile"),meta_profile:this.get("meta-profile"),enforce_duration:this.get("enforce-duration"),recover_streams:this.get("recover-streams"),max_duration:this.get("timelimit"),user_language:navigator.language||navigator.userLanguage,video_file_name:this._videoFileName,device_info:Objs.extend({api_version:2,embed_code:a},Device.info)}},__recordingTypeParams:function(){return this.isFlash()?{flash_recording:!0}:this.recorder?{webrtc_recording:!0,create_stream:!0,webrtc_streaming:this.application.data.get("webrtc_streaming")}:{create_stream:!0}},_prepareRecording:function(){return this._requiresDeviceOrientation=Info.isMobile()&&Info.isiOS()&&void 0!==window.orientation&&this.recorder,this.get("video")?this.application.streams.create(this.get("video"),this.__recordingTypeParams(),this.get("auth")).mapSuccess(function(a){this.set("stream",a.token),this.set("stream_data",a),this._updateUrls()},this):this.application.videos.create(Objs.extend(this.__createParams(),this.__recordingTypeParams()),this.get("auth")).mapSuccess(function(a){this.set("video",a.video.token),this.set("video_data",a.video),this.set("stream",a.stream.token),this.set("stream_data",a.stream),this._updateUrls()},this)},_verifyRecording:function(){var a=Promise.create();return Async.eventually(function(){if(this.get("video")){var b=this.get("simulate")?Promise.value(!0):this.application.streams._recorder_submit(this.get("video"),this.get("stream"),{rotation:this._requiresDeviceOrientation?this._readDeviceOrientation():void 0},this.get("auth"),50);b.success(function(){this.__inputBindElement&&(this.__inputBindElement.value=this.get("video")),this.get("form-accept")&&this._formAcceptEvents.off(document.querySelector(this.get("form-accept")),"submit"),this.application.videos.cacheInvalidate(this.get("video"))},this).forwardCallback(a)}},this,2500),a},_afterActivate:function(b){a._afterActivate.apply(this,arguments),this.get("input-bind")&&(this.__inputBindElement=document.getElementsByName(this.get("input-bind"))[0],this.__inputBindElement||(this.__inputBindElement=document.createElement("input"),this.__inputBindElement.type="hidden",this.__inputBindElement.id=this.get("input-bind"),this.__inputBindElement.name=this.get("input-bind"),b.parentElement.appendChild(this.__inputBindElement)),this.get("video")&&(this.__inputBindElement.value=this.get("video")))}}},function(a){return{recorderStates:function(){return a.recorderStates.call(this).concat([RecorderStates])}}}).register("ba-ziggeorecorder").register("ziggeorecorder").registerFunctions({testing:function(obj){with(obj)return testing}}).attachStringTable(Locale.mainLocale).addStrings({})}),Scoped.define("module:PopupRecorder",["module:Recorder","mediacomponents:PopupHelper"],function(a,b,c){return a.extend({scoped:c},b.mixin)}),Scoped.define("module:RecorderStates.Recording",["mediacomponents:VideoRecorder.Dynamics.RecorderStates.Recording"],function(a,b){return a.extend({scoped:b},function(a){return{_started:function(){a._started.call(this),this.dyn._track("record_start")},_hasStopped:function(){a._hasStopped.call(this),this.dyn._track("record_end",{media_time:this.dyn.get("duration")})}}})}),Scoped.define("module:RecorderStates.Chooser",["mediacomponents:VideoRecorder.Dynamics.RecorderStates.Chooser"],function(a,b){return a.extend({scoped:b},function(a){return{_uploadFile:function(b){a._uploadFile.call(this,b),this.dyn._track("upload_start",{data_size:b.size})}}})}),Scoped.define("module:RecorderStates.CovershotSelection",["mediacomponents:VideoRecorder.Dynamics.RecorderStates.CovershotSelection"],function(a,b){return a.extend({scoped:b},function(a){return{_nextUploading:function(b){this.dyn._track(b?"cover_skip":"cover_select"),a._nextUploading.call(this,b)}}})}),Scoped.define("module:RecorderStates.Uploading",["mediacomponents:VideoRecorder.Dynamics.RecorderStates.Uploading","base:Time"],function(a,b,c){return a.extend({scoped:c},function(a){return{_started:function(){a._started.call(this),this.dyn.__had_processed=!1,this.dyn._track("uploading_start",{data_size:this.dyn._dataUploader.totalBytes()})},_finished:function(){a._finished.call(this),this.dyn._track("uploading_end",{media_time:this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"),data_size:this.dyn._dataUploader.totalBytes(),bandwidth:this.dyn._dataUploader.totalBytes()/(this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"))}),this.dyn._track("upstream_bandwidth",{media_time:this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"),data_size:this.dyn._dataUploader.totalBytes(),bandwidth:this.dyn._dataUploader.totalBytes()/(this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"))}),this.dyn.setProp("playerattrs.forcerefresh",b.now())}}})}),Scoped.define("private:Application.VideosApiMixin",function(){return{index:function(a,b,c){return this.application.connect.request("/videos/",{method:"GET",auth:b,resilience:c,data:a})},destroy:function(a,b,c){return this.application.connect.request("/videos/"+a,{method:"DELETE",auth:b,resilience:c})},create:function(a,b,c){return this.application.connect.request("/videos",{method:"POST",auth:b,resilience:c,data:a})},update:function(a,b,c,d){return this.application.connect.request("/videos/"+a,{method:"POST",auth:c,resilience:d,data:b})},_playback:function(a,b,c,d){return this.application.connect.request("/videos/"+a+"/playback",{method:"POST",auth:c,resilience:d,data:b})},get:function(a,b,c){return this.application.connect.request("/videos/"+a,{method:"GET",auth:b,resilience:c})}}}),Scoped.define("private:Application.StreamsApiMixin",function(){return{index:function(a,b,c,d){return this.application.connect.request("/videos/"+a+"/streams/",{method:"GET",auth:c,resilience:d,data:b})},destroy:function(a,b,c,d){return this.application.connect.request("/videos/"+a+"/streams/"+b,{method:"DELETE",auth:c,resilience:d})},create:function(a,b,c,d){return this.application.connect.request("/videos/"+a+"/streams",{method:"POST",auth:c,resilience:d,data:b})},accept:function(a,b,c,d){return this.application.connect.request("/videos/"+a+"/streams/"+b+"/accept",{method:"POST",auth:c,resilience:d})},_image_attach:function(a,b,c,d,e){return this.application.connect.request("/videos/"+a+"/streams/"+b+"/imageattach",{method:"POST",auth:d,resilience:e,data:c})},_audio_attach:function(a,b,c,d,e){return this.application.connect.request("/videos/"+a+"/streams/"+b+"/audioattach",{method:"POST",auth:d,resilience:e,data:c})},_recorder_submit:function(a,b,c,d,e){return this.application.connect.request("/videos/"+a+"/streams/"+b+"/recordersubmit",{method:"POST",auth:d,resilience:e,data:c})},_uploader_state:function(a,b,c,d){return this.application.connect.request("/videos/"+a+"/streams/"+b+"/uploaderstate",{method:"GET",auth:c,resilience:d})},_subtitle_attach:function(a,b,c,d){return this.application.connect.request("/videos/"+a+"/streams/"+b+"/subtitleattach",{method:"POST",auth:c,resilience:d})}}})}).call(Scoped);